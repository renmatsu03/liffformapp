<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>#中学受験ニガテ克服講座-申込フォーム</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <style>
        input[type="submit"] {
            display: block;
            width: 50%;
            margin: 20px auto;
            padding: 15px;
            font-size: 1.2em;
        }
        .form-row {
            display: flex;
            justify-content: space-between;
        }
        .form-row > div {
            flex: 1;
            margin-right: 10px;
        }
        .form-row > div:last-child {
            margin-right: 0;
        }
    </style>
</head>
<body>
    <form class="w-75 mx-auto mt-5">
        <!-- LINE名（自動取得） -->
        <p class="mt-3">LINE名</p>
        <div>
            <input class="form-control w-100 mt-1" name="lineName" placeholder="LINE名を取得中..." readonly>
        </div>

        <!-- 漢字の姓名 -->
        <p class="mt-3">名前（漢字）</p>
        <div class="form-row">
            <div>
                <input class="form-control" name="lastName" placeholder="姓" required>
            </div>
            <div>
                <input class="form-control" name="firstName" placeholder="名" required>
            </div>
        </div>

        <!-- ふりがなの姓名 -->
        <p class="mt-3">名前（ふりがな）</p>
        <div class="form-row">
            <div>
                <input class="form-control" name="lastNameKana" placeholder="せい" required>
            </div>
            <div>
                <input class="form-control" name="firstNameKana" placeholder="めい" required>
            </div>
        </div>

        <!-- 学年 -->
        <p class="mt-3">学年</p>
        <div>
            <select class="form-control w-100 mt-1" name="grade" required>
                <option value="" disabled selected>選択してください</option>
                <option>小学6年</option>
                <option>小学5年</option>
                <option>小学4年</option>
                <option>小学3年</option>
                <option>小学2年</option>
                <option>小学1年</option>
            </select>
        </div>

        <!-- 講座の購入コマ数 -->
        <p class="mt-3">講座の購入コマ数</p>
        <div>
            <select class="form-control w-100 mt-1" id="koma-select" required>
                <option value="" disabled selected>選択してください</option>
                <option value="free">★第1回分無料</option>
                <option value="1">1コマ ★第1回分無料</option>
                <option value="3">3コマ ★第1回分無料</option>
                <option value="5">5コマ ★第1回分無料</option>
                <option value="10">10コマ ★第1回分無料</option>
                <option value="20">20コマ ★第1回分無料</option>
            </select>
        </div>

        <!-- 講座選択 -->
        <p class="mt-3">講座選択</p>
        <div id="lecture-options" class="form-group">
            <!-- 講座リストを動的に生成 -->
        </div>

        <input type="submit" class="mt-4 btn btn-primary" value="送信" disabled>
    </form>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        $(document).ready(function () {
            const liffId = "2006792721-3gajN1ll"; // LIFF ID

            // LINE名の取得
            liff.init({ liffId: liffId })
                .then(() => {
                    if (liff.isLoggedIn()) {
                        liff.getProfile().then(profile => {
                            $('input[name="lineName"]').val(profile.displayName);
                        });
                    } else {
                        liff.login();
                    }
                });

            $("form").submit(function () {
                const lineName = $('input[name="lineName"]').val();
                const lastName = $('input[name="lastName"]').val();
                const firstName = $('input[name="firstName"]').val();
                const lastNameKana = $('input[name="lastNameKana"]').val();
                const firstNameKana = $('input[name="firstNameKana"]').val();
                const grade = $('select[name="grade"]').val();
                const selectedKoma = $('#koma-select').val();
                const selectedLectures = $(".lecture-checkbox:checked").map(function () {
                    return $(this).val();
                }).get();

                const msg = `#中学受験ニガテ克服講座-申込フォーム\nLINE名: ${lineName}\n名前（漢字）: ${lastName} ${firstName}\n名前（ふりがな）: ${lastNameKana} ${firstNameKana}\n学年: ${grade}\n購入コマ数: ${selectedKoma === "free" ? "★第1回分無料" : selectedKoma + "コマ"}\n選択した講座:\n${selectedLectures.join("\n")}`;

                if (liff.isInClient()) {
                    liff.sendMessages([{ type: 'text', text: msg }])
                        .then(() => {
                            alert("メッセージが送信されました");
                            liff.closeWindow();
                        })
                        .catch(error => console.error("メッセージ送信失敗:", error));
                } else {
                    alert("LINE アプリ内で実行してください");
                }
                return false;
            });
        });
    </script>
</body>
</html>
